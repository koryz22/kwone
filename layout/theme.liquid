<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="{{ settings.color_background | default: '#0a0a0a' }}">
  
  {%- if canonical_url != blank -%}
    <link rel="canonical" href="{{ canonical_url }}">
  {%- endif -%}

  {%- if settings.favicon != blank -%}
    <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
  {%- endif -%}

  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; {{ 'general.meta.tags' | t: tags: current_tags | join: ', ' }}{% endif -%}
    {%- if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  {% if page_description %}
    <meta name="description" content="{{ page_description | escape }}">
  {% endif %}

  {% render 'meta-tags' %}

  <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
  {{ content_for_header }}

  {%- liquid
    assign body_font_bold = settings.type_body_font | font_modify: 'weight', 'bold'
    assign body_font_italic = settings.type_body_font | font_modify: 'style', 'italic'
    assign body_font_bold_italic = body_font_bold | font_modify: 'style', 'italic'
  %}

  {% style %}
    {{ settings.type_body_font | font_face: font_display: 'swap' }}
    {{ body_font_bold | font_face: font_display: 'swap' }}
    {{ body_font_italic | font_face: font_display: 'swap' }}
    {{ body_font_bold_italic | font_face: font_display: 'swap' }}
    {{ settings.type_header_font | font_face: font_display: 'swap' }}

    :root {
      --font-body-family: {{ settings.type_body_font.family }}, {{ settings.type_body_font.fallback_families }};
      --font-body-style: {{ settings.type_body_font.style }};
      --font-body-weight: {{ settings.type_body_font.weight }};
      --font-body-weight-bold: {{ settings.type_body_font.weight | plus: 300 | at_most: 1000 }};

      --font-heading-family: {{ settings.type_header_font.family }}, {{ settings.type_header_font.fallback_families }};
      --font-heading-style: {{ settings.type_header_font.style }};
      --font-heading-weight: {{ settings.type_header_font.weight }};

      --color-base-text: {{ settings.colors_text.red }}, {{ settings.colors_text.green }}, {{ settings.colors_text.blue }};
      --color-base-background: {{ settings.colors_background_1.red }}, {{ settings.colors_background_1.green }}, {{ settings.colors_background_1.blue }};
      --color-base-accent: {{ settings.colors_accent_1.red }}, {{ settings.colors_accent_1.green }}, {{ settings.colors_accent_1.blue }};
    }

    *,
    *::before,
    *::after {
      box-sizing: inherit;
    }

    html {
      box-sizing: border-box;
      font-size: calc(var(--font-body-scale) * 62.5%);
      height: 100%;
    }

    body {
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      grid-template-columns: 100%;
      min-height: 100%;
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: 0.06rem;
      line-height: calc(1 + 0.8 / var(--font-body-scale));
      font-family: var(--font-body-family);
      font-style: var(--font-body-style);
      font-weight: var(--font-body-weight);
      color: rgb(var(--color-base-text));
      background-color: rgb(var(--color-base-background));
    }
  {% endstyle %}

  {{ 'base.css' | asset_url | stylesheet_tag }}
  {{ 'lookbook.css' | asset_url | stylesheet_tag }}
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script>document.documentElement.className = document.documentElement.className.replace('no-js', 'js');</script>
</head>

<body class="lookbook-theme">
  <a class="skip-to-content-link button visually-hidden" href="#MainContent">
    {{ 'accessibility.skip_to_text' | t }}
  </a>

  {% section 'header' %}

  <!-- Scrolling Marquee Bar -->
  <div class="marquee-bar">
    <div class="marquee-content" id="marquee-content">
      <!-- Original content set - will be duplicated dynamically by JS -->
      <div class="marquee-group" data-marquee-group="original">
        <div class="marquee-item marquee-stars">
          <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <div class="marquee-item">
          <span class="marquee-text">KWONE 2026</span>
        </div>
        <div class="marquee-item">
          <span class="marquee-text">Philadelphia, PA</span>
        </div>
        <div class="marquee-item">
          <span class="marquee-text">Suits. Fitness. Discipline.</span>
        </div>
      </div>
    </div>
  </div>

  <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
    {{ content_for_layout }}
  </main>

  {% section 'footer' %}

  <!-- Newsletter Popup Modal -->
  <div id="newsletter-popup" class="newsletter-popup" style="display: none;">
    <div class="newsletter-popup-overlay"></div>
    <div class="newsletter-popup-content">
      <button class="newsletter-popup-close" id="newsletter-popup-close" aria-label="Close popup">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <h2 class="newsletter-popup-title">Subscribe to our email</h2>
      <p class="newsletter-popup-message">Get a 10% off code when you subscribe!</p>

      {%- form 'customer', id: 'ContactPopup', class: 'newsletter-popup-form' -%}
        <input type="hidden" name="contact[tags]" value="newsletter">
        <div class="newsletter-popup-form__field-wrapper">
          <div class="field newsletter-popup-field">
            <input
              id="NewsletterForm--popup"
              type="email"
              name="contact[email]"
              class="newsletter-popup-input field__input"
              value="{{ form.email }}"
              aria-required="true"
              autocorrect="off"
              autocapitalize="off"
              autocomplete="email"
              {% if form.errors %}
                autofocus
                aria-invalid="true"
                aria-describedby="ContactPopup-error"
              {% elsif form.posted_successfully? %}
                aria-describedby="ContactPopup-success"
              {% endif %}
              placeholder="Enter your email..."
              required
            >
            <label class="field__label" for="NewsletterForm--popup">
              Enter your email...
            </label>
            <button
              type="submit"
              class="newsletter-popup-submit field__button"
              name="commit"
              id="SubscribePopup"
              aria-label="Subscribe"
            >
              SUBSCRIBE
            </button>
          </div>
          {%- if form.errors -%}
            <small class="newsletter-popup-form__message newsletter-popup-form__message--error form__message" id="ContactPopup-error">
              {{- form.errors.translated_fields.email | capitalize }}
              {{ form.errors.messages.email -}}
            </small>
          {%- endif -%}
        </div>
        {%- if form.posted_successfully? -%}
          <h3
            class="newsletter-popup-form__message newsletter-popup-form__message--success form__message"
            id="ContactPopup-success"
            tabindex="-1"
            autofocus
          >
            {{- 'newsletter.success' | t -}}
          </h3>
        {%- endif -%}
      {%- endform -%}
    </div>
  </div>

  <!-- Subscription Success Toast -->
  <div id="subscription-toast" class="subscription-toast">Thank you for subscribing!</div>

  <ul hidden>
    <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
  </ul>

  <script>
    window.shopUrl = '{{ request.origin }}';
    window.routes = {
      cart_add_url: '{{ routes.cart_add_url }}',
      cart_change_url: '{{ routes.cart_change_url }}',
      cart_update_url: '{{ routes.cart_update_url }}',
      cart_url: '{{ routes.cart_url }}',
      predictive_search_url: '{{ routes.predictive_search_url }}'
    };

    window.cartStrings = {
      error: `{{ 'sections.cart.cart_error' | t }}`,
      quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`
    }

    window.variantStrings = {
      addToCart: `{{ 'products.product.add_to_cart' | t }}`,
      soldOut: `{{ 'products.product.sold_out' | t }}`,
      unavailable: `{{ 'products.product.unavailable' | t }}`,
      unavailable_with_option: `{{ 'products.product.value_unavailable' | t: option_value: '[value]' }}`,
    }
  </script>

  <style>
    /* Scrolling Marquee Bar */
    .marquee-bar {
      position: relative;
      width: 100%;
      background: rgba(20, 27, 31);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      padding: 0.5rem 0;
      margin-top: 110px;
      margin-bottom: -50px;
      z-index: 10;
    }

    .marquee-content {
      display: flex;
      align-items: center;
      width: max-content;
      will-change: transform;
    }

    .marquee-group {
      display: flex;
      align-items: center;
      gap: 4rem;
      flex-shrink: 0;
      justify-content: flex-start;
    }

    .marquee-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-shrink: 0;
      white-space: nowrap;
      padding: 0 0.5rem;
    }

    .marquee-stars {
      gap: 0rem;
      margin-left: 3.5rem;
      margin-bottom: 0.2rem;
    }

    .star-icon {
      width: 18px;
      height: 18px;
      color: rgba(255, 255, 255, 0.7);
      fill: currentColor;
      flex-shrink: 0;
    }

    .marquee-item .star-icon {
      margin: 0;
    }

    .marquee-text {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-weight: 300;
      letter-spacing: 0.1em;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      white-space: nowrap;
    }

    @keyframes marquee-scroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(var(--marquee-offset, -50%));
      }
    }

    .marquee-content.initialized {
      animation: marquee-scroll 20s linear infinite;
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .marquee-bar {
        margin-top: 105px;
      }
    }

    @media (max-width: 768px) {
      .marquee-bar {
        margin-top: 90px;
        padding: 0.4rem 0;
      }

      .marquee-group {
        gap: 3rem;
      }

      .marquee-text {
        font-size: 0.8rem;
      }

      .star-icon {
        width: 16px;
        height: 16px;
      }
    }

    /* Newsletter Popup */
    .newsletter-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: popupFadeIn 0.3s ease;
    }

    .newsletter-popup-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
    }

    .newsletter-popup-content {
      position: relative;
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 3rem;
      max-width: 500px;
      width: 90%;
      z-index: 1;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .newsletter-popup-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      padding: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      width: 32px;
      height: 32px;
    }

    .newsletter-popup-close:hover {
      color: rgba(255, 255, 255, 1);
      transform: rotate(90deg);
    }

    .newsletter-popup-title {
      font-family: var(--font-sans);
      font-size: 1.8rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255, 255, 255, 0.9);
      margin: 0 0 1rem 0;
      text-align: center;
    }

    .newsletter-popup-message {
      font-family: var(--font-sans);
      font-size: 1.1rem;
      font-weight: 300;
      color: rgba(255, 255, 255, 0.7);
      margin: 0 0 2rem 0;
      text-align: center;
      line-height: 1.5;
    }

    .newsletter-popup-form {
      width: 100%;
    }

    .newsletter-popup-form__field-wrapper {
      width: 100%;
    }

    .newsletter-popup-field {
      display: flex;
      gap: 1rem;
      width: 100%;
      position: relative;
    }

    .newsletter-popup-field .field__label {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }

    .newsletter-popup-input {
      flex: 1;
      background: rgba(40, 40, 40, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 1.2rem 1.5rem;
      color: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      font-family: var(--font-sans);
      letter-spacing: 0.02em;
      transition: all 0.3s ease;
      min-height: 55px;
      width: 100%;
    }

    .newsletter-popup-input[aria-invalid="true"] {
      border-color: #f87171;
    }

    .newsletter-popup-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.9rem;
    }

    .newsletter-popup-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(50, 50, 50, 0.9);
    }

    .newsletter-popup-submit {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 1.2rem 2.5rem;
      font-size: 0.95rem;
      font-family: var(--font-sans);
      letter-spacing: 0.1em;
      font-weight: 400;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-height: 55px;
    }

    .newsletter-popup-submit:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      color: rgba(255, 255, 255, 1);
    }

    .newsletter-popup-submit:active {
      transform: scale(0.98);
    }

    .newsletter-popup-form__message {
      margin-top: 1rem;
      font-size: 0.9rem;
      font-family: var(--font-sans);
      text-align: center;
      display: block;
    }

    .newsletter-popup-form__message--success {
      color: #4ade80;
    }

    .newsletter-popup-form__message--error {
      color: #f87171;
    }

    @keyframes popupFadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .newsletter-popup-content {
        padding: 2rem 1.5rem;
      }

      .newsletter-popup-title {
        font-size: 1.5rem;
      }

      .newsletter-popup-message {
        font-size: 1rem;
      }

      /* Mobile: Stack input above button, full width */
      .newsletter-popup-field {
        flex-direction: column !important;
        gap: 1rem !important;
        width: 100% !important;
      }

      .newsletter-popup-input {
        width: 100% !important;
        flex: none !important;
        min-height: 50px !important;
        padding: 1rem 1.25rem !important;
        font-size: 1rem !important;
        display: block !important;
      }

      .newsletter-popup-submit {
        width: 100% !important;
        padding: 1rem 1.25rem !important;
        min-height: 50px !important;
        font-size: 0.95rem !important;
        white-space: normal !important;
        display: block !important;
        margin-top: 0 !important;
      }
    }

    /* DYNAMIC CENTERING: Shopify challenge container centered on page */
    
    /* Shopify challenge container - dynamically centered */
    .shopify-challenge__container {
      position: fixed !important;
      top: 40% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 10000 !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 2rem !important;
      max-width: 500px !important;
      width: 90% !important;
      padding: 2rem 1rem !important;
      pointer-events: auto !important;
    }

    /* All children inherit proper positioning from container */
    .shopify-challenge__container > * {
      position: relative !important;
      width: 100% !important;
      text-align: center !important;
    }

    /* Text elements - styled but positioned by container */
    .shopify-challenge__container p,
    .shopify-challenge__container label {
      margin: 0 !important;
      padding: 0 0 1rem 0 !important;
      z-index: 10001 !important;
    }

    /* Captcha widget - centered by container */
    .shopify-challenge__container div[id*="hcaptcha"],
    .shopify-challenge__container div[class*="h-captcha"],
    .shopify-challenge__container div[class*="hcaptcha"],
    .shopify-challenge__container iframe {
      margin: 0 auto !important;
      display: block !important;
      pointer-events: auto !important;
      cursor: pointer !important;
      z-index: 10001 !important;
    }

    /* Submit button - always visible, below captcha */
    .shopify-challenge__container button[type="submit"],
    .shopify-challenge__container input[type="submit"],
    .shopify-challenge__container > button {
      position: relative !important;
      z-index: 10002 !important; /* HIGHEST - always on top */
      pointer-events: auto !important;
      cursor: pointer !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      padding: 0.75rem 2rem !important;
      min-height: 44px !important;
      margin-top: 1rem !important;
      margin-left: auto !important;
      margin-right: auto !important;
    }

    /* Email marketing confirmation container - same styling as challenge container */
    .shopify-email-marketing-confirmation__container {
      position: fixed !important;
      top: 40% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 10000 !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 2rem !important;
      max-width: 500px !important;
      width: 90% !important;
      padding: 2rem 1rem !important;
      pointer-events: auto !important;
    }

    /* All children inherit proper positioning from container */
    .shopify-email-marketing-confirmation__container > * {
      position: relative !important;
      width: 100% !important;
      text-align: center !important;
    }

    /* Text elements - styled but positioned by container */
    .shopify-email-marketing-confirmation__container p,
    .shopify-email-marketing-confirmation__container label {
      margin: 0 !important;
      padding: 0 0 1rem 0 !important;
      z-index: 10001 !important;
    }

    /* Submit button - always visible */
    .shopify-email-marketing-confirmation__container button[type="submit"],
    .shopify-email-marketing-confirmation__container input[type="submit"],
    .shopify-email-marketing-confirmation__container > button {
      position: relative !important;
      z-index: 10002 !important; /* HIGHEST - always on top */
      pointer-events: auto !important;
      cursor: pointer !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      padding: 0.75rem 2rem !important;
      min-height: 44px !important;
      margin-top: 1rem !important;
      margin-left: auto !important;
      margin-right: auto !important;
    }

    /* Newsletter forms and buttons - also high z-index */
    .newsletter-form,
    .newsletter-popup-form,
    #ContactFooter,
    #ContactPopup {
      position: relative !important;
      z-index: 10003 !important;
      pointer-events: auto !important;
    }

    .newsletter-submit,
    .newsletter-popup-submit,
    #Subscribe,
    #SubscribePopup,
    button[type="submit"].field__button {
      position: relative !important;
      z-index: 10004 !important; /* Even higher for newsletter buttons */
      pointer-events: auto !important;
      cursor: pointer !important;
      margin-top: 1rem !important; /* Extra space below form */
    }

    /* Toast notification */
    .subscription-toast {
      position: fixed !important;
      top: 20px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      z-index: 999999 !important;
      background: rgba(74, 222, 128, 0.95) !important; /* Green success color */
      color: rgba(0, 0, 0, 0.9) !important;
      padding: 1rem 2rem !important;
      border-radius: 8px !important;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
      font-family: var(--font-sans) !important;
      font-size: 1rem !important;
      font-weight: 500 !important;
      text-align: center !important;
      display: none !important;
      animation: toastSlideIn 0.3s ease-out !important;
      min-width: 300px !important;
    }

    .subscription-toast.show {
      display: block !important;
    }

    @keyframes toastSlideIn {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @media (max-width: 768px) {
      .subscription-toast {
        top: 10px !important;
        left: 50% !important;
        right: auto !important;
        width: 90% !important;
        max-width: 350px !important;
        padding: 0.875rem 1.5rem !important;
        font-size: 0.9rem !important;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      /* Mobile: Ensure captcha is above all content including footer */
      .shopify-challenge__container {
        z-index: 999999 !important; /* Maximum z-index on mobile - above everything including footer */
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 90% !important;
        width: 85% !important;
        padding: 2rem 1.5rem !important;
        pointer-events: auto !important;
        background: rgba(255, 255, 255, 1) !important; /* White background */
        border-radius: 12px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
      }

      /* All captcha elements clickable on mobile */
      .shopify-challenge__container * {
        pointer-events: auto !important;
        z-index: 999999 !important;
      }

      .shopify-challenge__container div[id*="hcaptcha"],
      .shopify-challenge__container div[class*="h-captcha"],
      .shopify-challenge__container div[class*="hcaptcha"],
      .shopify-challenge__container iframe {
        z-index: 999999 !important;
        pointer-events: auto !important;
        cursor: pointer !important;
        max-width: 100% !important;
        background: transparent !important;
      }

      .shopify-challenge__container button[type="submit"],
      .shopify-challenge__container input[type="submit"] {
        z-index: 999999 !important;
        pointer-events: auto !important;
        cursor: pointer !important;
        width: 100% !important;
        max-width: 100% !important;
        background: rgba(0, 0, 0, 0.8) !important;
        color: rgba(255, 255, 255, 1) !important;
        border: 1px solid rgba(0, 0, 0, 0.2) !important;
      }

      /* Text elements in white container */
      .shopify-challenge__container p,
      .shopify-challenge__container label {
        color: rgba(0, 0, 0, 0.9) !important;
      }

      /* Email marketing confirmation container - mobile styling */
      .shopify-email-marketing-confirmation__container {
        z-index: 999999 !important; /* Maximum z-index on mobile - above everything including footer */
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 90% !important;
        width: 85% !important;
        padding: 2rem 1.5rem !important;
        pointer-events: auto !important;
        background: rgba(255, 255, 255, 1) !important; /* White background */
        border-radius: 12px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
      }

      .shopify-email-marketing-confirmation__container * {
        pointer-events: auto !important;
        z-index: 999999 !important;
      }

      .shopify-email-marketing-confirmation__container button[type="submit"],
      .shopify-email-marketing-confirmation__container input[type="submit"] {
        z-index: 999999 !important;
        pointer-events: auto !important;
        cursor: pointer !important;
        width: 100% !important;
        max-width: 100% !important;
        background: rgba(0, 0, 0, 0.8) !important;
        color: rgba(255, 255, 255, 1) !important;
        border: 1px solid rgba(0, 0, 0, 0.2) !important;
      }

      .shopify-email-marketing-confirmation__container p,
      .shopify-email-marketing-confirmation__container label {
        color: rgba(0, 0, 0, 0.9) !important;
      }

      /* Ensure footer stays below captcha and confirmation */
      footer,
      .site-footer,
      .footer-wrapper,
      .footer-content-grid {
        z-index: 1 !important;
        position: relative !important;
      }
    }

  </style>

  <script>
    (function() {
      // Initialize infinite marquee
      function initInfiniteMarquee() {
        const marqueeContent = document.getElementById('marquee-content');
        const marqueeBar = document.querySelector('.marquee-bar');
        if (!marqueeContent || !marqueeBar) return;

        const originalGroup = marqueeContent.querySelector('[data-marquee-group="original"]');
        if (!originalGroup) return;

        // Remove any existing duplicate groups
        const existingDuplicates = marqueeContent.querySelectorAll('[data-marquee-group="duplicate"]');
        existingDuplicates.forEach(dup => dup.remove());

        // Measure the width of one content group
        const groupWidth = originalGroup.offsetWidth;
        if (groupWidth === 0) {
          // Content not yet rendered, retry after a short delay
          setTimeout(initInfiniteMarquee, 50);
          return;
        }

        const viewportWidth = window.innerWidth;

        // Calculate how many duplicates we need for seamless infinite scrolling
        // The animation moves exactly one group width, so we need enough groups
        // to cover the viewport width plus the scroll distance
        // Formula: total groups needed = (viewportWidth + groupWidth) / groupWidth + buffer
        const totalGroupsNeeded = Math.ceil((viewportWidth + groupWidth) / groupWidth) + 1;
        const duplicatesNeeded = Math.max(1, totalGroupsNeeded - 1); // -1 because we already have the original

        // Clone and append groups
        for (let i = 0; i < duplicatesNeeded; i++) {
          const clone = originalGroup.cloneNode(true);
          clone.setAttribute('data-marquee-group', 'duplicate');
          marqueeContent.appendChild(clone);
        }

        // Set the animation offset to exactly one group width
        // This ensures seamless looping: when animation completes, it resets to 0
        // and the duplicate groups are positioned to continue seamlessly
        marqueeContent.style.setProperty('--marquee-offset', `-${groupWidth}px`);

        // Mark as initialized to start animation
        marqueeContent.classList.add('initialized');
      }

      // Initialize on load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          // Small delay to ensure layout is complete
          setTimeout(initInfiniteMarquee, 100);
        });
      } else {
        setTimeout(initInfiniteMarquee, 100);
      }

      // Re-initialize on window resize (debounced)
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          const marqueeContent = document.getElementById('marquee-content');
          if (marqueeContent) {
            marqueeContent.classList.remove('initialized');
            initInfiniteMarquee();
          }
        }, 250);
      });
    })();
  </script>

  <script>
    (function() {
      // Check for successful subscription on page load (from either form)
      function checkForSuccessfulSubscription() {
        const popupSuccess = document.getElementById('ContactPopup-success');
        const footerSuccess = document.getElementById('ContactFooter-success');
        
        // Check if success message is visible (form.posted_successfully? is true)
        if ((popupSuccess && popupSuccess.offsetParent !== null) || 
            (footerSuccess && footerSuccess.offsetParent !== null)) {
          // User successfully subscribed - mark in session
          sessionStorage.setItem('newsletter-subscribed', 'true');
          return true;
        }
        return false;
      }

      // Check if already subscribed in this session
      if (checkForSuccessfulSubscription()) {
        // User already subscribed this session, don't show popup
        return;
      }

      // Check if popup was already dismissed OR if user subscribed in this session
      const popupDismissed = localStorage.getItem('newsletter-popup-dismissed');
      const sessionSubscribed = sessionStorage.getItem('newsletter-subscribed');
      if (popupDismissed || sessionSubscribed) {
        return;
      }

      const popup = document.getElementById('newsletter-popup');
      const closeBtn = document.getElementById('newsletter-popup-close');
      const popupForm = document.getElementById('ContactPopup');
      const footerForm = document.getElementById('ContactFooter');

      // Function to check if hCaptcha is visible on the page
      function isCaptchaVisible() {
        const captchaSelectors = [
          'div[id*="hcaptcha"]',
          'div[class*="h-captcha"]',
          'div[class*="hcaptcha"]',
          'iframe[src*="hcaptcha"]',
          'iframe[src*="challenges.cloudflare.com"]',
          'div[id*="challenge"]',
          'form[action*="challenge"]'
        ];
        
        for (let i = 0; i < captchaSelectors.length; i++) {
          try {
            const elements = document.querySelectorAll(captchaSelectors[i]);
            for (let j = 0; j < elements.length; j++) {
              const el = elements[j];
              const style = window.getComputedStyle(el);
              const isVisible = style.display !== 'none' && 
                               style.visibility !== 'hidden' && 
                               (el.offsetWidth > 0 || el.offsetHeight > 0);
              
              if (isVisible) {
                return true;
              }
            }
          } catch (e) {
            // Continue checking other selectors
          }
        }
        
        return false;
      }

      // Function to show popup only if no captcha is visible and not subscribed
      function showPopupIfNoCaptcha() {
        // Check if user subscribed in this session
        const sessionSubscribed = sessionStorage.getItem('newsletter-subscribed');
        if (!popup || popupDismissed || sessionSubscribed || isCaptchaVisible()) {
          return;
        }
        
        // Double-check one more time before showing
        if (!isCaptchaVisible() && !sessionSubscribed) {
          popup.style.display = 'flex';
          document.body.style.overflow = 'hidden';
        }
      }

      // Show popup after 10 seconds (only if no captcha is visible)
      setTimeout(function() {
        showPopupIfNoCaptcha();
      }, 10000);

      // Close button handler
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          popup.style.display = 'none';
          document.body.style.overflow = '';
          localStorage.setItem('newsletter-popup-dismissed', 'true');
        });
      }

      // Close on overlay click
      const overlay = popup?.querySelector('.newsletter-popup-overlay');
      if (overlay) {
        overlay.addEventListener('click', function() {
          popup.style.display = 'none';
          document.body.style.overflow = '';
          localStorage.setItem('newsletter-popup-dismissed', 'true');
        });
      }

      // Track form submission state to prevent double submission
      let formSubmitting = false;
      let captchaBeingHandled = false;

      // Close popup on successful form submission
      if (popupForm) {
        popupForm.addEventListener('submit', function(e) {
          // Prevent double submission
          if (formSubmitting) {
            e.preventDefault();
            e.stopPropagation();
            return false;
          }

          // Check if captcha is currently visible
          if (isCaptchaVisible() && !captchaBeingHandled) {
            // Captcha is visible - mark that we're handling it
            captchaBeingHandled = true;
            formSubmitting = true;
            
            // Hide newsletter popup when captcha appears
            setTimeout(function() {
              if (isCaptchaVisible()) {
                popup.style.display = 'none';
                document.body.style.overflow = '';
              }
            }, 100);

            // Allow form to submit - Shopify will handle captcha
            // Don't prevent default, just mark as submitting
            return true;
          }

          // No captcha visible or captcha already handled
          // Normal form submission
          formSubmitting = true;
          
          // Disable submit button to prevent double submission
          const submitBtn = popupForm.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = true;
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'SUBSCRIBING...';
          }
          
          // Check for success after a delay
          setTimeout(function() {
            const successMessage = document.getElementById('ContactPopup-success');
            if (successMessage && successMessage.offsetParent !== null) {
              // Form was successful, mark as subscribed in session
              sessionStorage.setItem('newsletter-subscribed', 'true');
              
              // Check if captcha was just completed
              const captchaJustCompleted = captchaState.isVerified && captchaState.verificationCount > 0;
              
              if (captchaJustCompleted) {
                // Show toast and redirect
                if (window.handleSuccessfulSubscription) {
                  window.handleSuccessfulSubscription();
                }
              } else {
                // Close popup after 3 seconds (normal flow without captcha)
                setTimeout(function() {
                  popup.style.display = 'none';
                  document.body.style.overflow = '';
                  localStorage.setItem('newsletter-popup-dismissed', 'true');
                  formSubmitting = false;
                  captchaBeingHandled = false;
                }, 3000);
              }
            } else {
              // Check if captcha appeared (page reload or captcha challenge)
              // Reset flags if captcha appeared so form can be submitted again after captcha
              if (isCaptchaVisible()) {
                captchaBeingHandled = true;
                // Don't reset formSubmitting yet - wait for captcha to complete
              } else {
                // No captcha and no success - might be an error, reset
                formSubmitting = false;
                captchaBeingHandled = false;
                if (submitBtn) {
                  submitBtn.disabled = false;
                  submitBtn.textContent = originalText || 'SUBSCRIBE';
                }
              }
            }
          }, 500);
        });
      }

      // Monitor footer form for successful subscription
      if (footerForm) {
        // Check on page load if footer form was successful
        setTimeout(function() {
          const footerSuccess = document.getElementById('ContactFooter-success');
          if (footerSuccess && footerSuccess.offsetParent !== null) {
            // Footer form was successful - mark in session
            sessionStorage.setItem('newsletter-subscribed', 'true');
          }
        }, 100);

        // Monitor for success message appearing dynamically
        const footerSuccessObserver = new MutationObserver(function(mutations) {
          const footerSuccess = document.getElementById('ContactFooter-success');
          if (footerSuccess && footerSuccess.offsetParent !== null) {
            // Footer form was successful - mark in session
            sessionStorage.setItem('newsletter-subscribed', 'true');
            
            // If captcha was completed, show toast and redirect
            setTimeout(function() {
              if (captchaState.isVerified && window.handleSuccessfulSubscription) {
                window.handleSuccessfulSubscription();
              }
            }, 500);
          }
        });

        // Observe the footer form area for success message
        const footerFormWrapper = footerForm.closest('.footer-newsletter');
        if (footerFormWrapper) {
          footerSuccessObserver.observe(footerFormWrapper, {
            childList: true,
            subtree: true,
            attributes: true
          });
        }
      }

      // Monitor for captcha completion - when captcha disappears after being visible
      let captchaWasVisible = false;
      let captchaVerificationComplete = false;
      
      const captchaMonitor = setInterval(function() {
        const captchaIsVisible = isCaptchaVisible();
        
        if (captchaIsVisible && !captchaWasVisible) {
          // Captcha just appeared - reset verification flag
          captchaWasVisible = true;
          captchaVerificationComplete = false;
          if (formSubmitting) {
            captchaBeingHandled = true;
          }
        } else if (!captchaIsVisible && captchaWasVisible) {
          // Captcha was visible but now disappeared - verification completed
          captchaWasVisible = false;
          captchaVerificationComplete = true;
          captchaBeingHandled = false;
          
          // Reset form submission flags after captcha completion
          setTimeout(function() {
            // Allow form to submit now that captcha is complete
            formSubmitting = false;
          }, 100);
        }
      }, 300);

      // Monitor for captcha appearance and hide newsletter popup if it appears
      const captchaObserver = new MutationObserver(function(mutations) {
        if (isCaptchaVisible() && popup && popup.style.display === 'flex') {
          // Captcha appeared while newsletter popup is showing, hide newsletter popup
          popup.style.display = 'none';
          document.body.style.overflow = '';
          // Don't mark as dismissed so it can show again later if needed
        }
      });
      
      // Observe the entire document for captcha elements
      captchaObserver.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['style', 'class', 'id', 'src']
      });
    })();
  </script>

  <script>
    // Comprehensive hCaptcha Handler - Prevents double triggers, ensures form submission
    (function() {
      'use strict';
      
      // Global state tracking
      const captchaState = {
        isVisible: false,
        isVerified: false,
        verificationCount: 0,
        maxVerifications: 1, // Only allow one verification per submission
        activeForms: new Set()
      };

      // Function to check if captcha is visible
      function checkCaptchaVisible() {
        const selectors = [
          'div[id*="hcaptcha"]:not([style*="display: none"])',
          'div[class*="h-captcha"]:not([style*="display: none"])',
          'iframe[src*="hcaptcha"]:not([style*="display: none"])',
          'form[action*="challenge"]:not([style*="display: none"])'
        ];
        
        for (const selector of selectors) {
          try {
            const elements = document.querySelectorAll(selector);
            for (const el of elements) {
              const style = window.getComputedStyle(el);
              if (style.display !== 'none' && 
                  style.visibility !== 'hidden' && 
                  (el.offsetWidth > 0 || el.offsetHeight > 0)) {
                return true;
              }
            }
          } catch (e) {}
        }
        return false;
      }

      // Ensure submit buttons are always accessible
      function ensureSubmitButtonsAccessible() {
        const buttons = document.querySelectorAll(
          '.newsletter-submit, .newsletter-popup-submit, ' +
          'button[type="submit"], input[type="submit"]'
        );
        
        buttons.forEach(btn => {
          btn.style.cssText += `
            position: relative !important;
            z-index: 10002 !important;
            pointer-events: auto !important;
            cursor: pointer !important;
          `;
        });
      }

      // Prevent double captcha triggers
      function handleFormSubmission(form) {
        if (!form) return;
        
        const formId = form.id || 'form-' + Math.random().toString(36).substr(2, 9);
        
        // Prevent multiple submissions
        if (captchaState.activeForms.has(formId)) {
          return false;
        }
        
        captchaState.activeForms.add(formId);
        
        form.addEventListener('submit', function(e) {
          // If captcha is verified, allow submission immediately
          if (captchaState.isVerified && captchaState.verificationCount >= captchaState.maxVerifications) {
            captchaState.activeForms.delete(formId);
            return true; // Allow submission
          }
          
          // If captcha is visible but not yet verified, wait for verification
          if (captchaState.isVisible && !captchaState.isVerified) {
            // Don't prevent - let Shopify handle it
            return true;
          }
          
          // No captcha, allow submission
          captchaState.activeForms.delete(formId);
          return true;
        }, { once: true });
      }

      // Check if mobile device (small screens only)
      function isMobile() {
        return window.innerWidth <= 768;
      }

      // Hide/show footer on mobile ONLY based on captcha
      function toggleFooterForCaptcha(captchaVisible) {
        // Only hide footer on mobile screens (768px and below)
        // Desktop and larger/mid screens keep footer visible
        if (!isMobile()) {
          // Desktop/mid screens: ensure footer is always visible
          const footer = document.querySelector('footer, .site-footer');
          if (footer) {
            footer.style.display = '';
          }
          return;
        }
        
        // Mobile only: hide/show footer based on captcha
        const footer = document.querySelector('footer, .site-footer');
        if (!footer) return;
        
        if (captchaVisible) {
          // Hide footer when captcha is visible (mobile only)
          footer.style.display = 'none';
        } else {
          // Show footer when captcha is gone (mobile only)
          footer.style.display = '';
        }
      }

      // Redirect to home immediately after successful subscription
      window.handleSuccessfulSubscription = function() {
        // Check if subscription was successful
        const popupSuccess = document.getElementById('ContactPopup-success');
        const footerSuccess = document.getElementById('ContactFooter-success');
        const wasSuccessful = (popupSuccess && popupSuccess.offsetParent !== null) || 
                             (footerSuccess && footerSuccess.offsetParent !== null);
        
        if (wasSuccessful && captchaState.isVerified) {
          // Redirect immediately to home page with subscribed parameter
          window.location.href = 'https://ceoaccessories.com?subscribed=true';
        }
      };

      // Monitor captcha state
      function monitorCaptcha() {
        const currentlyVisible = checkCaptchaVisible();
        
        if (currentlyVisible && !captchaState.isVisible) {
          // Captcha just appeared
          captchaState.isVisible = true;
          captchaState.isVerified = false;
          ensureSubmitButtonsAccessible();
          toggleFooterForCaptcha(true); // Hide footer on mobile
        } else if (!currentlyVisible && captchaState.isVisible) {
          // Captcha disappeared - verification complete
          captchaState.isVisible = false;
          captchaState.isVerified = true;
          captchaState.verificationCount++;
          ensureSubmitButtonsAccessible();
          toggleFooterForCaptcha(false); // Show footer again on mobile
          
          // Allow forms to submit now
          captchaState.activeForms.clear();
          
          // Check for successful subscription and handle redirect
          setTimeout(function() {
            if (window.handleSuccessfulSubscription) {
              window.handleSuccessfulSubscription();
            }
          }, 1000);
        } else if (currentlyVisible && captchaState.isVisible) {
          // Captcha still visible, ensure footer is hidden
          toggleFooterForCaptcha(true);
        }
      }

      // Initialize on all forms
      function initializeForms() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
          // Skip challenge forms themselves
          if (form.action && form.action.includes('challenge')) {
            return;
          }
          
          handleFormSubmission(form);
        });
        
        ensureSubmitButtonsAccessible();
      }

      // Check on page load if subscription was successful (after captcha)
      function checkPageLoadSuccess() {
        const popupSuccess = document.getElementById('ContactPopup-success');
        const footerSuccess = document.getElementById('ContactFooter-success');
        const wasSuccessful = (popupSuccess && popupSuccess.offsetParent !== null) || 
                             (footerSuccess && footerSuccess.offsetParent !== null);
        
        // If success message exists and no captcha is visible (captcha was completed)
        if (wasSuccessful && !checkCaptchaVisible()) {
          // Captcha was completed and form succeeded - redirect immediately
          setTimeout(function() {
            captchaState.isVerified = true; // Mark as verified
            if (window.handleSuccessfulSubscription) {
              window.handleSuccessfulSubscription();
            }
          }, 500);
        }
      }

      // Show toast on home page if redirected from subscription
      function showSubscriptionToast() {
        // Check for subscribed parameter in URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('subscribed') === 'true') {
          // Remove parameter from URL (clean URL)
          urlParams.delete('subscribed');
          const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
          window.history.replaceState({}, '', newUrl);
          
          // Show toast notification
          const toast = document.getElementById('subscription-toast');
          if (toast) {
            toast.classList.add('show');
            
            // Hide toast after 4 seconds
            setTimeout(function() {
              toast.classList.remove('show');
            }, 4000);
          }
        }
      }

      // Run monitoring
      setInterval(monitorCaptcha, 200);
      
      // Initialize on load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          initializeForms();
          setTimeout(checkPageLoadSuccess, 500);
          showSubscriptionToast(); // Check for subscription toast on page load
        });
      } else {
        initializeForms();
        setTimeout(checkPageLoadSuccess, 500);
        showSubscriptionToast(); // Check for subscription toast on page load
      }
      
      // Re-initialize on dynamic content
      const observer = new MutationObserver(function() {
        initializeForms();
        ensureSubmitButtonsAccessible();
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    })();
  </script>

</body>
</html>
